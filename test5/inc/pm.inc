
//----------------------------------------------------------------------------
// 描述符类型值说明
// 其中:
//       DA_  : Descriptor Attribute
//       D    : 数据段
//       C    : 代码段
//       S    : 系统段
//       R    : 只读
//       RW   : 读写
//       A    : 已访问
//       其它 : 可按照字面意思理解
//----------------------------------------------------------------------------
.set DA_32 , 0x4000   # 32 位段

.set DA_DPL0 , 0x00	# DPL = 0
.set DA_DPL1 , 0x20	# DPL = 1
.set DA_DPL2 , 0x40	# DPL = 2
.set DA_DPL3 , 0x60	# DPL = 3
//----------------------------------------------------------------------------
// 存储段描述符类型值说明
//----------------------------------------------------------------------------
.set DA_DR , 0x90	# 存在的只读数据段类型值
.set DA_DRW , 0x92	# 存在的可读写数据段属性值
.set DA_DRWA , 0x93	# 存在的已访问可读写数据段类型值
.set DA_C , 0x98	# 存在的只执行代码段属性值
.set DA_CR , 0x9A	# 存在的可执行可读代码段属性值
.set DA_CCO , 0x9C	# 存在的只执行一致代码段属性值
.set DA_CCOR , 0x9E	# 存在的可执行可读一致代码段属性值
//----------------------------------------------------------------------------
// 系统段描述符类型值说明
//----------------------------------------------------------------------------
.set DA_LDT , 0x82	# 局部描述符表段类型值
.set DA_TaskGat , 0x85	# 任务门类型值
.set DA_386TS , 0x89	# 可用 386 任务状态段类型值
.set DA_386CGat , 0x8C	# 386 调用门类型值
.set DA_386IGat , 0x8E	# 386 中断门类型值
.set DA_386TGat , 0x8F	# 386 陷阱门类型值
//----------------------------------------------------------------------------


// 选择子类型值说明
// 其中:
//       SA_  : Selector Attribute

.set SA_RPL0 , 0	# ┓
.set SA_RPL1 , 1	# ┣ RPL
.set SA_RPL2 , 2	# ┃
.set SA_RPL3 , 3	# ┛

.set SA_TIG , 0	# ┓TI
.set SA_TIL , 4	# ┛
//----------------------------------------------------------------------------

//segment descriptor

.macro SegDesc base, limit, attr
        .word    (\limit) & 0xffff
        .word    (\base)  & 0xffff
        .byte    ((\base) >> 16) & 0xff
        .word    ((\limit) >> 8) & 0xf00 | ((\attr) & 0xf0ff )
        .byte    ((\base) >> 24) & 0xff
.endm


// 门
// usage: Gate Selector, Offset, DCount, Attr
//        Selector:  dw
//        Offset:    dd
//        DCount:    db
//        Attr:      db
.macro Gate selector, offset, dcount, attr
    .word   ((\offset) & 0xFFFF)              # 偏移 1				(2 字节)
    .word   (\selector)                         # 选择子				(2 字节)
    .word   ((\dcount) & 0x1F) | (((\attr) << 8) & 0xFF00)   # 属性					(2 字节)
    .word   (((\offset) >> 16) & 0xFFFF)      # 偏移 2				(2 字节)
.endm                                   #共 8 字节
// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
